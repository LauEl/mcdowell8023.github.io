function loadImages(t,s){var i=0,h=0,n={};for(var o in t){h++;var e=new Image;n[o]=e,e.onload=function(){i++,i==h&&s&&s(n)},e.src=t[o]}}function a2d(t){return 180*t/Math.PI}function d2a(t){return t*Math.PI/180}function rnd(t,s){return Math.floor(Math.random()*(s-t)+t)}function Sprite(t){this.oImg=t,this.sx=0,this.sy=0,this.x=0,this.y=0,this.w=0,this.h=0,this.rotate=0,this.speed=2}function Fish(t,s){Sprite.call(this,t["fish"+s]),this.count=0,this.type=s,this.rotate=90;var i=[null,{w:37,h:55},{w:64,h:78},{w:56,h:72},{w:59,h:77},{w:122,h:107}];this.w=i[s].w,this.h=i[s].h}function Cannon(t,s){Sprite.call(this,t["cannon"+s]),this.count=0,this.type=s}function Bullet(t,s){Sprite.call(this,t),this.speed=10;var i=[null,{sx:32,sy:35,w:27,h:31},{sx:30,sy:82,w:29,h:33},{sx:0,sy:82,w:30,h:34},{sx:30,sy:0,w:31,h:35},{sx:0,sy:0,w:30,h:44},{sx:0,sy:0,w:30,h:44},{sx:0,sy:0,w:30,h:44},{sx:0,sy:0,w:30,h:44}];this.sx=i[s].sx,this.sy=i[s].sy,this.w=i[s].w,this.h=i[s].h,this.type=s}function Coin(t,s){switch(s){case 1:case 2:case 3:s=1;break;case 4:case 5:s=2}Sprite.call(this,t["coinAni"+s]);var i=[null,{w:60,h:60},{w:60,h:60}];this.w=i[s].w,this.h=i[s].h,this.type=s,this.count=0}function DieFish(t,s){Sprite.call(this,t["fish"+s]),this.count=0,this.type=s,this.rotate=90;var i=[null,{w:37,h:55},{w:64,h:78},{w:56,h:72},{w:59,h:77},{w:122,h:107}];this.w=i[s].w,this.h=i[s].h,this.sx=4*this.w}function Web(t,s){Sprite.call(this,t);var i=[null,{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200},{sx:22,sy:22,w:200,h:200}];this.sx=i[s].sx,this.sy=i[s].sy,this.w=i[s].w,this.h=i[s].h,this.type=s,this.scale=.5}Sprite.prototype.draw=function(t){t.save(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),t.drawImage(this.oImg,this.sx,this.sy,this.w,this.h,-this.w/2,-this.h/2,this.w,this.h),t.restore()},Sprite.prototype.move=function(){var t=Math.cos(d2a(this.rotate-90))*this.speed,s=Math.sin(d2a(this.rotate-90))*this.speed;this.x+=t,this.y+=s},Sprite.prototype.collTest=function(t){var s=Math.min(this.w,this.h)/2,i=Math.min(t.w,t.h)/2,h=this.x-t.x,n=this.y-t.y,o=Math.sqrt(h*h+n*n);return o<=.6*(s+i)},Fish.prototype=new Sprite,Fish.prototype.constructor=Fish;var oldMove=Sprite.prototype.move;Sprite.prototype.move=function(){oldMove.call(this),this.count++,this.count%4==0&&(this.sx+=this.w,this.sx>=3*this.w&&(this.sx=0))},Cannon.prototype=new Sprite,Cannon.prototype.constructor=Cannon,Bullet.prototype=new Sprite,Bullet.prototype.constructor=Bullet,Coin.prototype=new Sprite,Coin.prototype.constructor=Coin,Coin.prototype.move=function(){this.count++,this.count%3==0&&(this.sy+=this.h,this.sy>=9*this.h&&(this.sy=0)),this.x+=(0-this.x)/20,this.y+=(700-this.y)/20},DieFish.prototype=new Sprite,DieFish.prototype.constructor=DieFish,DieFish.prototype.move=function(){this.count++,this.count%4==0&&(this.sx+=this.w,this.sx>=7*this.w&&(this.sx=4*this.w))},Web.prototype=new Sprite,Web.prototype.constructor=Web,Web.prototype.draw=function(t){t.save(),t.translate(this.x,this.y),t.scale(this.scale,this.scale),t.drawImage(this.oImg,this.sx,this.sy,this.w,this.h,-this.w/2,-this.h/2,this.w,this.h),t.restore()},window.onload=function(){var t=document.getElementById("c1"),s=t.getContext("2d");loadImages({fish1:"img/fish1.png",fish2:"img/fish2.png",fish3:"img/fish3.png",fish4:"img/fish4.png",fish5:"img/fish5.png",bottom:"img/bottom.png",bullet:"img/bullet.png",cannon1:"img/cannon1.png",cannon2:"img/cannon2.png",cannon3:"img/cannon3.png",cannon4:"img/cannon4.png",cannon5:"img/cannon5.png",cannon6:"img/cannon6.png",cannon7:"img/cannon7.png",coinAni1:"img/coinAni1.png",coinAni2:"img/coinAni2.png",web:"img/web.png"},function(i){var h=new Sprite(i.bottom);h.w=765,h.h=70,h.x=t.width/2,h.y=t.height-h.h/2;var n=new Cannon(i,7);n.w=74,n.h=94,n.x=450,n.y=566,t.onmousemove=function(s){var i=s.clientX-n.x-t.offsetLeft,h=n.y+t.offsetTop-s.clientY,o=Math.atan2(h,i);n.rotate=90-a2d(o)};var o=[];t.onclick=function(){var t=new Bullet(i.bullet,7);t.x=n.x,t.y=n.y,t.rotate=n.rotate,o.push(t)};var e=[];setInterval(function(){var s=new Fish(i,rnd(1,6));e.push(s),s.y=rnd(100,t.height-100),Math.random()<.5?(s.x=-200,s.rotate=rnd(60,120)):(s.x=t.width+200,s.rotate=rnd(-60,-120))},200);var r=[],a=[],c=[];setInterval(function(){s.clearRect(0,0,t.width,t.height);for(var p=0;p<e.length;p++)e[p].draw(s),e[p].move();h.draw(s),n.draw(s);for(var p=0;p<o.length;p++)o[p].draw(s),o[p].move();for(var p=0;p<r.length;p++)r[p].draw(s),r[p].move();for(var p=0;p<a.length;p++)a[p].draw(s),a[p].move(),setTimeout(function(){a.shift()},300);for(var p=0;p<c.length;p++)c[p].draw(s),c[p].scale+=.1,c[p].scale>1.2&&(c[p].scale=1,c.splice(p--,1));for(var p=0;p<o.length;p++)for(var w=0;w<e.length;w++)if(o[p].collTest(e[w])){var l=e[w].x,y=e[w].y,u=e[w].type,f=e[w].rotate;e.splice(w--,1),o.splice(p--,1);var g=new Coin(i,u);g.x=l,g.y=y,r.push(g);var x=new DieFish(i,u);x.x=l,x.y=y,x.rotate=f,a.push(x);var v=new Web(i.web,u);v.x=l,v.y=y,c.push(v)}},30)})};